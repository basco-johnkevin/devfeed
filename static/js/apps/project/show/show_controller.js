// Generated by CoffeeScript 1.6.3
(function() {
  define(["devfeed", "common_view", "project_show_view"], function(Devfeed, CommonView, ProjectShowView) {
    Devfeed.module("ProjectApp.Show", function(Show, Devfeed, Backbone, Marionette, $, _) {
      return Show.Controller = {
        showProject: function(id) {
          var fetchingProject, preloaderView;
          preloaderView = new CommonView.Preloader();
          Devfeed.contentRegion.show(preloaderView);
          fetchingProject = Devfeed.request("project:entity", id);
          return $.when(fetchingProject).done(function(project) {
            var chatboxView, chatinfoView, findStoryView, projectShowView, sidebarView, storiesView;
            sidebarView = new ProjectShowView.Sidebar({
              model: project
            });
            chatinfoView = new ProjectShowView.Chatinfo;
            chatboxView = new ProjectShowView.Chatbox;
            projectShowView = new ProjectShowView.Show({
              model: project
            });
            Devfeed.contentRegion.show(projectShowView);
            projectShowView.sidebarRegion.show(sidebarView);
            projectShowView.chatinfoRegion.show(chatinfoView);
            projectShowView.chatboxRegion.show(chatboxView);
            storiesView = new ProjectShowView.Stories({
              collection: project.get("stories")
            });
            storiesView.on("stories:more", function() {
              var fetchingStories;
              fetchingStories = Devfeed.request("project:stories:more", project.get("id"));
              return $.when(fetchingStories).done(function() {
                return storiesView.triggerMethod("more:stories");
              });
            });
            storiesView.on("filters:changed", function(filters) {
              var filteringStories;
              filteringStories = Devfeed.request("project:stories:filter", project.get("id"), filters);
              return $.when(filteringStories).done(function() {
                return sidebarView.triggerMethod("stories:filtered");
              });
            });
            sidebarView.storiesRegion.show(storiesView);
            findStoryView = new ProjectShowView.FindStory;
            findStoryView.on("settings:shown", function() {
              return sidebarView.triggerMethod("settings:shown");
            });
            findStoryView.on("settings:hidden", function() {
              return sidebarView.triggerMethod("settings:hidden");
            });
            findStoryView.on("filters:changed", function(filters) {
              return sidebarView.triggerMethod("filters:changed", filters);
            });
            return sidebarView.findStoryRegion.show(findStoryView);
          });
        }
      };
    });
    return Devfeed.ProjectApp.Show.Controller;
  });

}).call(this);
